# Maintainer: graysky <therealgraysky AT protonmail DOT com>
# Maintainer: Kevin Mihelich <kevin@archlinuxarm.org>

pkgname=raspberrypi-bootloader
pkgver=20240213
pkgrel=1
_commit=a43df3a002f60c4c2243a416d045eb5937585e8b
arch=('any')
url="https://github.com/raspberrypi/firmware"
license=('custom')
options=(!strip)
source=("bootloader-$pkgver-${_commit:0:10}.tar.gz::https://github.com/raspberrypi/firmware/archive/${_commit}.tar.gz"
         fixup4.dat start4.elf)

md5sums=('a7e656f7e090587daa6b46f3fc0d7d40'
         '39bb311fd1db7c639aaffddf37f630de'
         'f1cf42f2ee9d3b6d9bbb2f8c41608ed7')

package() {
  pkgdesc="Bootloader files for Raspberry Pi"
  replaces=('raspberrypi-firmware-bootloader' 'raspberrypi-bootloader-x' 'raspberrypi-firmware-bootloader-x')
  conflicts=('raspberrypi-bootloader-x')

  mkdir -p "${pkgdir}"/boot
  cp "${srcdir}"/firmware-${_commit}/boot/{*.dat,*.bin,*.elf} "${pkgdir}"/boot

  # https://github.com/raspberrypi/firmware/issues/1868  
  rm "${pkgdir}"/boot/start4.elf "${pkgdir}"/boot/fixup4.dat
  cp fixup4.dat start4.elf "${pkgdir}"/boot
}
